name: Pull Request Config 🤖

on:
  issues:
    types: [opened, reopened]
  pull_request:
    types: [opened, reopened]

jobs:
  auto-assign:
    uses: devxp-tech/.github/.github/workflows/auto-assign.yaml@main
    secrets: inherit
    with:
      assignees: diegoluisi
      numOfAssignee: 1

  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Label PRs
        uses: ffittschen/pr-branch-labeler@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Label Chart
        uses: actions/labeler@v4
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          sync-labels: true

  helm-diff:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout 🛎️
      uses: actions/checkout@v3

    - name: Generate Results
      run: |
        helm template charts/devxp-dev --set name=ci  > results_new.yaml

    - name: Diff Results
      run: |
        diff charts/devxp-dev/results.yaml results_new.yaml > diff.yaml

    - name: PR comment with file
      uses: thollander/actions-comment-pull-request@v2
      with:
        filePath: diff.yaml